# 어떤 요구사항이 추가되었을까?

---

### 현재까지의 요구사항

- 현재까지 만든 로그 추적기는 지금까지의 요구사항을 만족했다
- 그런데, 요구사항을 만족하기 위해서 기존 코드를 많이 수정해야 된다
    - 코드 수정을 최소화하기 위해서 템플릿 메서드 패턴, 콜백 패턴등도 사용했지만, 결과적으로 **로그를 남기고 싶은 클래스가 수백개**라면 **수백개의 코드 모두 수정**해줘야 한다

### 추가 요구사항

- **원본 코드를 전혀 수정하지 않고, 로그 추적기를 적용해라**
- 특정 메서드는 로그를 출력하지 않는 기능
    - 보안상 일부 로그는 출력하지 않도록
- 다음과 같은 **다양한 케이스에 적용**할 수 있어야 한다
    - v1 - 인터페이스가 있는 구현 클래스
    - v2 - 인터페이스가 없는 구체 클래스
    - v3 - 컴포넌트 스캔 대상에 기능 적용

# 프록시

---

### 프록시 전에 클라이언트 - 서버에 관해 알아보자

- `Client` - `Server`의 기본 개념
    - `Client`: 서버에 필요한 것을 요청
    - `Server`: 클라이언트의 요청을 처리
    - 네트워크에 도입하면 클라이언트 = 웹 브라우저, 서버 = 웹서버
    - 객체에 도입하면 클라이언트 = 요청하는 객체, 서버 = 요청을 처리하는 객체

### 직접 호출과 간접 호출

- 직접 호출

  ![proxy1](https://user-images.githubusercontent.com/57485510/165203645-d4e63264-9322-4538-a1ad-73bfb552567b.png)

- 간접 호출

  ![proxy5](https://user-images.githubusercontent.com/57485510/165203659-9b00a6d2-b085-4d97-b3d7-2853d49e75ce.png)

    - 클라이언트의 요청을 대리자(`proxy`)를 통해서 간접적으로 서버에 요청할 수 있다
    - 예) 직접 마트에서 장을 보는 것(직접호출), 장을 대신 누군가에게 봐달라고 요청하는 것(간접호출)

### 여러가지 일상예시로 이해해보자

- 엄마에게 라면을 사달라고 부탁했는데, 엄마는 그 라면이 집에 있다고 한다(**직접호출**, **캐싱**)
- 아빠에게 자동차 주유를 부탁했는데, 주유 뿐만 아니라 세차까지 부가적으로 해주셨다(**부가 기능 추가**)
- 동생에게 라면을 사달라고 했는데, 동생은 다른 누군가에게 다시 라면을 사달라고 부탁했다(**프록시 체인**)

![proxy2](https://user-images.githubusercontent.com/57485510/165203652-92ba3b5c-02a8-41ec-a934-759f9a686fcd.png)


### 대체 가능

- 아무 객체나 프록시가 되는 것이 아니다
- 객체에서 프록시가 되려면, **클라이언트는 서버에게 요청한 것이 맞는지 프록시에게 요청한 것인지 몰라야 한다** ← 같은 인터페이스를 사용
- 클라이언트가 사용하는 서버 객체를 프록시 객체로 변경해도 클라이언트는 몰라야 한다

![proxy3](https://user-images.githubusercontent.com/57485510/165203655-2b5ec466-7e83-4af7-a962-b97a67c24bd4.png)


### 서버와 프록시가 같은 인터페이스 사용

- 서버와 프록시가 같은 인터페이스 사용 ← DI를 사용해서 대체 가능하다

![proxy4](https://user-images.githubusercontent.com/57485510/165203656-c85c7764-7acd-4a9e-a6f0-471b01033ae5.png)

- DI를 사용해서 `Client → Server`에서 `Client → Proxy`로 객체 의존관계를 변경해도 클라이언트 코드에 변경하지 않아도 된다( 클라이언트는 변경사실 모르게 )

### 프록시 주요기능

- 접근 제어
    - 권한에 따른 접근 차단
    - 캐싱
    - 지연 로딩
- 부가 기능 추가
    - 원래 서버가 제공하는 기능의 +@기능(부가기능) 수행
    - 예) 요청 값이나, 응답 값을 중간에서 변경
    - 예) 실행 시간을 측적해서 추가 로그를 남김